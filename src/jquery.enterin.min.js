/*
* EnterIN jQuery Plugin v2.0
* 
* Copyright 2013 Gianfilippo Balestriero < enterin.github@gmail.com >
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*       http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* 
*/

(function(e){e.fn.enterin=function(t){var n={controllers:false,maxScale:20,effectTime:3,ease:"linear",endCallback:function(){}};var r=e.extend({},n,t);var i={init:function(e){i.isInit=true;i.ctrl=false;i.wrapper=jQuery(e);if(r.controllers!=false){i.ctrl=jQuery(r.controllers)}else{i.ctrl=false}i.reorderSlide();i.setWrapperStyle();i.setSlidesStyle();i.bindControllers();i.bindAnimation()},reorderSlide:function(){var e=i.wrapper.clone();var t=e.find(".enterin-slide").length-1;i.wrapper.text("");var n;for(var r=0;r<t+1;r++){n=e.find(".enterin-slide").eq(t-r);i.wrapper.append(n)}i.calcStyle()},setWrapperStyle:function(){i.wrapper.css("position","relative");i.wrapper.css("overflow","hidden")},setSlidesStyle:function(){var e=r.effectTime+"s";var t=r.ease;var n=i.wrapper.find(".enterin-slide").length;var s=r.effectTime/n;i.changeSlide(1);setTimeout(function(){i.wrapper.find(".enterin-slide").css("position","absolute");i.wrapper.find(".enterin-slide").css("top","0px");i.wrapper.find(".enterin-slide").css("left","0px");for(var e=0;e<=n;e++){i.wrapper.find(".enterin-slide").eq(n-e).css("transition","all "+s*e+"s "+r.ease)}},10)},bindControllers:function(){i.isInit=false;var e;if(i.ctrl!=false){e=i.ctrl.find("[data-enterin]")}else{e=jQuery("[data-enterin]")}e.click(function(){var e=jQuery(this);var t=e.data("enterin");i.changeSlide(t)})},bindAnimation:function(){var e=i.wrapper.find(".enterin-slide").length;jQuery(".enterin-slide").unbind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend");jQuery(".enterin-slide").eq(i.to-1).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){if(i.isInit){i.isInit=false;return}else{r.endCallback(i.to)}})},changeSlide:function(e,t){if(typeof t=="undefined"){t=false}for(var n=1;n<=i.vars.count;n++){var r=i.vars.count-n+1;if(n<e){scale=i.vars.count-n+1;opacity=.2/(i.vars.count-n+1)}else if(n>e){scale=i.vars.scales[n-1];opacity=i.vars.scales[n-1]}else{scale=1;if(t){scale=t}opacity=1}i.wrapper.find(".enterin-slide").eq(r-1).css("transform","scale("+scale+")");i.wrapper.find(".enterin-slide").eq(r-1).css("opacity",opacity)}i.to=e;i.bindAnimation()},calcStyle:function(){var e=i.wrapper.find(".enterin-slide").length;var t=r.maxScale/e;var n=1/r.maxScale;var s=[];for(var o=1;o<=e;o++){var u=n*t*(e+1-o);var a=u;s.push(a)}i.vars={count:e,scales:s}}};e.fn.enterin.goToSlide=function(e,t){setTimeout(function(){i.changeSlide(e,t)},30)};return this.each(function(){i.init(this)})}})(jQuery)